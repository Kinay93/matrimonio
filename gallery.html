<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galleria - Matrimonio</title>
    <link rel="stylesheet" href="style.css">
</head>
<body class="gallery-page">
<header>
    <h1>La nostra Galleria</h1>
</header>
<section class="gallery" id="gallery-container">
    <!-- Foto dinamiche -->
</section>
<a href="upload.html" class="pulsante" id="upload-btn">Carica una foto</a>
<a href="index.html" class="pulsante" id="home-btn">Home</a>
<script src="script.js"></script>
<script>
    window.onload = async () => {
    const params = new URLSearchParams(window.location.search);
    const coppia = params.get("coppia") || "default";

    await loadIndexData(coppia);
    await applicaTemaCoppia(coppia);
    document.getElementById("home-btn").href = `index.html?coppia=${encodeURIComponent(coppia)}`;
    document.getElementById("upload-btn").href = `upload.html?coppia=${encodeURIComponent(coppia)}`;

};
    const params = new URLSearchParams(window.location.search);
    const coppia = params.get("coppia") || "default";

    async function loadGallery(coppia) {
        try {
            // URL assoluto verso App Engine
            const res = await fetch(`https://matrimonioapp.ew.r.appspot.com/gallery?coppia=${encodeURIComponent(coppia)}`);
            const files = await res.json();
            const container = document.getElementById("gallery-container");
            container.innerHTML = "";

            files.forEach(file => {
                const img = document.createElement("img");
                img.src = file.file_url || file.url;
                img.alt = file.filename || file.name;
                img.className = "gallery-img";
                container.appendChild(img);
            });

            // Aggiorna link upload e home
            document.getElementById("upload-btn").href = `upload.html?coppia=${encodeURIComponent(coppia)}`;
            document.getElementById("home-btn").href = `index.html?coppia=${encodeURIComponent(coppia)}`;
        } catch (err) {
            console.error("Errore caricamento galleria:", err);
        }
    }

    const params = new URLSearchParams(window.location.search);
        const coppia = params.get("coppia") || "default";

        async function loadIndexData(coppia) {
            try {
                // URL completo verso App Engine
                const res = await fetch(`https://matrimonioapp.ew.r.appspot.com/admin/get_coppia?coppia=${encodeURIComponent(coppia)}`);
                const data = await res.json();

                if (data.error) {
                    console.warn("Coppia non trovata, uso default");
                    return;
                }

                // Titolo
                document.getElementById("title").textContent = data.titolo_index || "Benvenuti al nostro matrimonio";

                // Colori e font
                if (data.colori) {
                    document.body.style.backgroundColor = data.colori.sfondo || "#ffffff";
                    document.body.style.color = data.colori.testo || "#000000";
                    document.getElementById("title").style.fontFamily = data.colori.font || "Arial";
                }

                // Foto
                if (data.foto_url) {
                    document.getElementById("index-photo").src = data.foto_url;
                }

                // Aggiorna link galleria
                document.getElementById("galleria-btn").href = `gallery.html?coppia=${encodeURIComponent(coppia)}`;

            } catch (err) {
                console.error("Errore caricamento dati index:", err);
            }
        }
</script>
</body>
</html>
