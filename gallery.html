<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galleria - Matrimonio</title>
    <link rel="stylesheet" href="style.css">
</head>
<body class="gallery-page">
<header>
    <h1>La nostra Galleria</h1>
</header>
<section class="gallery" id="gallery-container">
    <!-- Foto dinamiche -->
</section>
<a href="upload.html" class="pulsante" id="upload-btn">Carica una foto</a>
<a href="index.html" class="pulsante" id="home-btn">Home</a>

<script>
        window.onload = async () => {
            // Applica tema admin appena carica la pagina
            await applicaTemaAdmin();

            // Carica la lista coppie
            caricaCoppie();
        };
    const params = new URLSearchParams(window.location.search);
    const coppia = params.get("coppia") || "default";

    async function loadGallery(coppia) {
        try {
            // URL assoluto verso App Engine
            const res = await fetch(`https://matrimonioapp.ew.r.appspot.com/gallery?coppia=${encodeURIComponent(coppia)}`);
            const files = await res.json();
            const container = document.getElementById("gallery-container");
            container.innerHTML = "";

            files.forEach(file => {
                const img = document.createElement("img");
                img.src = file.file_url || file.url;
                img.alt = file.filename || file.name;
                img.className = "gallery-img";
                container.appendChild(img);
            });

            // Aggiorna link upload e home
            document.getElementById("upload-btn").href = `upload.html?coppia=${encodeURIComponent(coppia)}`;
            document.getElementById("home-btn").href = `index.html?coppia=${encodeURIComponent(coppia)}`;
        } catch (err) {
            console.error("Errore caricamento galleria:", err);
        }
    }

    loadGallery(coppia);
</script>
</body>
</html>
